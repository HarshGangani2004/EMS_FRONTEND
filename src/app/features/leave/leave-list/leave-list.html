<div class="department-container">

  <!-- HEADER -->
  <div class="header-row">
    <h2>My Leaves</h2>

    <div class="header-actions">

      <!-- âœ… SEARCH (EMPLOYEE LIST STYLE) -->
      <input
        type="text"
        class="search-input"
        placeholder="Search by leave type or status..."
        [(ngModel)]="searchText" />

      <button
        class="add-btn"
        routerLink="/leave/create"
        *hasPermission="'leave.create'">
        + Apply Leave
      </button>

    </div>
  </div>

  <!-- ðŸ”¥ FILTER BAR (UNCHANGED â€“ BACKEND BASED) -->
  <div class="filter-bar">

    <!-- YEAR -->
    <select [(ngModel)]="filters.year">
      <option [ngValue]="null">Year</option>
      <option *ngFor="let y of years" [ngValue]="y">{{ y }}</option>
    </select>

    <!-- MONTH -->
    <select [(ngModel)]="filters.month">
      <option [ngValue]="null">Month</option>
      <option *ngFor="let m of [1,2,3,4,5,6,7,8,9,10,11,12]" [ngValue]="m">
        {{ m }}
      </option>
    </select>

    <!-- STATUS -->
    <select [(ngModel)]="filters.status" class="x">
      <option value="">All Status</option>
      <option value="Pending">Pending</option>
      <option value="Approved">Approved</option>
      <option value="Rejected">Rejected</option>
      <option value="Unpaid">Unpaid</option>
    </select>

    <!-- LEAVE TYPE -->
    <select [(ngModel)]="filters.leaveType">
      <option value="">All Leave Types</option>
      <option *ngFor="let t of leaveTypes" [value]="t">{{ t }}</option>
    </select>

    <!-- FILTER ACTIONS -->
    <button class="btn-apply" (click)="applyFilter()">Apply</button>
    <button class="btn-clear" (click)="resetFilter()">Reset</button>

  </div>

  <!-- LOADING -->
  <p *ngIf="loading">Loading leaves...</p>

  <!-- TABLE -->
  <div class="table-wrapper" *ngIf="!loading">
    <table class="department-table">

      <thead>
        <tr>
          <th>#</th>
          <th>Leave Type</th>
          <th>From</th>
          <th>To</th>
          <th>Status</th>
          <th class="actions-header">Actions</th>
        </tr>
      </thead>

      <tbody>

        <!-- âœ… SEARCHED DATA (FRONTEND FILTER) -->
        <tr *ngFor="let l of filteredLeaves; let i = index">
          <td>{{ (page - 1) * pageSize + i + 1 }}</td>
          <td>{{ l.leaveType }}</td>
          <td>{{ l.fromDate | date:'dd-MM-yyyy' }}</td>
          <td>{{ l.toDate | date:'dd-MM-yyyy' }}</td>

          <td>
            <span class="status-badge" [ngClass]="l.status.toLowerCase()">
              {{ l.status }}
            </span>
          </td>

          <td class="action-buttons">
            <button class="icon-btn view" (click)="view(l.id)">
              <i class="bi bi-eye"></i>
            </button>

            <ng-container *ngIf="l.status === 'Pending'">
              <ng-container *hasPermission="'leave.update'">
                <button class="icon-btn edit" (click)="edit(l.id)">
                  <i class="bi bi-pencil"></i>
                </button>
              </ng-container>

              <ng-container *hasPermission="'leave.delete'">
                <button class="icon-btn delete" (click)="delete(l.id)">
                  <i class="bi bi-trash"></i>
                </button>
              </ng-container>
            </ng-container>
          </td>
        </tr>

        <tr *ngIf="filteredLeaves.length === 0">
          <td colspan="6" class="no-data">No leaves found</td>
        </tr>

      </tbody>
    </table>
  </div>

  <!-- PAGINATION -->
  <div class="pagination" *ngIf="!loading">
    <button (click)="prevPage()" [disabled]="page === 1">Prev</button>
    <span>Page {{ page }} of {{ totalPages }}</span>
    <button (click)="nextPage()" [disabled]="page === totalPages">Next</button>
  </div>

</div>
